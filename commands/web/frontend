#!/bin/bash
#ddev-generated - Do not modify this file; your modifications will be overwritten.

## Description: Run the frontend command inside the web container
## Usage: frontend [flags] [args]
## Example: "ddev frontend"
## Aliases: f, fe
## ExecRaw: true
## HostWorkingDir: false

# Check if we're running in DDEV
if [[ -z "${DDEV_PROJECT}" ]]; then
    echo -e "\nError: This script must be run inside DDEV\n"
    exit 1
fi

# shellcheck source=woodoo_components/variables
if [[ -f ".ddev/commands/web/woodoo_components/variables" ]]; then
    source ".ddev/commands/web/woodoo_components/variables"
else
    echo -e "\nError: Required file .ddev/commands/web/woodoo_components/variables not found\n"
    exit 1
fi

echo -e "${bldblu}DDEV Woodoo Frontend Buildtools ${WOODOO_VERSION} for Magento ${txtrst}"

# Check if the user wants to see the version
if [[ $1 == "version" || $1 == "--version" ]]; then
    exit 0
fi

# Check if WOODOO_VERSION and LATEST_WOODOO_VERSION are set
if [[ -z "${WOODOO_VERSION}" || -z "${LATEST_WOODOO_VERSION}" ]]; then
    echo -e "\nError: WOODOO_VERSION or LATEST_WOODOO_VERSION is not set\n"
    exit 1
fi

# Check if the installed version is outdated
if [[ ${WOODOO_VERSION} != "${LATEST_WOODOO_VERSION}" ]]; then
    echo -e "üß± ${txtcyn}Installed Version ${bldred}${WOODOO_VERSION}${txtrst}"
    echo -e "‚≠êÔ∏è ${txtcyn}The newer Version ${bldgrn}${LATEST_WOODOO_VERSION} is available!${txtrst}"
    echo -e "üëâ ${txtgrn}Install update with: ${txtcyn}ddev frontend-update${txtrst}"
fi

# Load all required files
for file in functions themes build watch selftest help; do
    if [[ -f ".ddev/commands/web/woodoo_components/$file" ]]; then
        source ".ddev/commands/web/woodoo_components/$file"
    else
        echo -e "${txtred}\nError: Required file .ddev/commands/web/woodoo_components/$file not found\n${txtrst}"
        exit 1
    fi
done
